<tool id="flexynesis_plot" name="Flexynesis plot" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>tool for visualizing flexynesis results</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
        @CHECK_NON_COMMERCIAL_USE@
        mkdir -p input/ &&

    ]]></command>
    <inputs>
        <param name="non_commercial_use" label="I certify that I am not using this tool for commercial purposes." type="boolean" truevalue="NON_COMMERCIAL_USE" falsevalue="COMMERCIAL_USE" checked="False">
            <validator type="expression" message="This tool is only available for non-commercial use.">value == True</validator>
        </param>
        <conditional name="plot_conditional">
            <param name="plot_type" type="select" label="flexynesis plot">
                <option value="dimred">Dimensionality reduction</option>
                <option value="kaplan_meier">Kaplan-Meier</option>
                <option value="scatter">Scatter plot of known vs predicted labels</option>
                <option value="concordance_heatmap">Label concordance heatmap</option>
                <option value="pr_curve">Precision-recall curves</option>
                <option value="roc_curve">ROC curves</option>
                <option value="box_plot">Box plot</option>
            </param>
            <when value="dimred">
                <expand macro="plots">
                    <expand macro="common_plot_input"/>
                    <param argument="--embeddings" type="data" format="tabular,csv" label="Embeddings" help="Generated by flexynesis"/>
                    <param name="method" type="select" label="Transformation method">
                        <option value="pca" selected="true">PCA</option>
                        <option value="umap">UMAP</option>
                    </param>
                </expand>
            </when>
            <when value="kaplan_meier">
                <expand macro="plots">
                    <param argument="--labels" type="data" format="tabular,csv" label="Predicted labels" help="Generated by flexynesis"/>
                    <param argument="--survival_data" type="data" format="tabular,csv" label="Survival data" help="Clinical survival data"/>
                    <param argument="--surv_event_var" type="text" label="Survival event" help="Which column in survival data to use as event/status indicator for survival modeling.">
                        <sanitizer invalid_char="">
                            <valid initial="string.printable"></valid>
                        </sanitizer>
                    </param>
                    <param argument="--surv_time_var" type="text" label="Survival time" help="Which column in survival data to use as time/duration indicator for survival modeling.">
                        <sanitizer invalid_char="">
                            <valid initial="string.printable"></valid>
                        </sanitizer>
                    </param>
                    <param argument="--clinical_variables" type="text" label="Clinical covariates" optional="true" help="Comma-separated list of clinical covariates to include in the Cox model (e.g SEX, AGE, ...).">
                        <sanitizer invalid_char="">
                            <valid initial="string.printable"></valid>
                        </sanitizer>
                    </param>
                    <param argument="--top_features" type="integer" min="1" value="20" label="Number of top important features to include in Cox model"/>
                    <param argument="--event_value" type="text" label="Event value" optional="false" help="The value in the event column that indicates an event (e.g. death) has occurred.">
                        <sanitizer invalid_char="">
                            <valid initial="string.printable"></valid>
                        </sanitizer>
                    </param>
                </expand>
            </when>
            <when value="scatter">
                <expand macro="plots">
                    <expand macro="common_plot_input"/>
                </expand>
            </when>
            <when value="concordance_heatmap">
                <expand macro="plots">
                    <expand macro="common_plot_input"/>
                </expand>
            </when>
            <when value="pr_curve">
                <expand macro="plots">
                    <expand macro="common_plot_input"/>
                </expand>
            </when>
            <when value="roc_curve">
                <expand macro="plots">
                    <expand macro="common_plot_input"/>
                </expand>
            </when>
            <when value="box_plot">
                <expand macro="plots">
                    <expand macro="common_plot_input"/>
                </expand>
            </when>
        </conditional>
    </inputs>
    <outputs>
        <collection name="plots" type="list" label="${tool.name} on ${on_string}">
            <discover_datasets pattern="__name_and_ext__" directory="plots"/>
        </collection>
    </outputs>
    <tests>

    </tests><help><![CDATA[
    **Flexynesis plot**



    ]]></help>
    <citations>
        <citation type="doi">10.1101/2024.07.16.603606</citation>
    </citations>
</tool>